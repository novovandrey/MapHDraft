<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Mapping Health</title>
    <script src="add/d3.v4.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="d3-tip2.js"></script>
    <script src="colorbrewer.js" type="text/javascript"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-rc.2/css/materialize.min.css">
	<script src="add/materialize.min.js"></script>
    <script src="add/d3-scale-chromatic.v1.min.js"></script>
    <script src="add/topojson.js"></script>
	<script src="d3.slider.js"></script>
	<script src="add/d3-simple-slider.js"></script>
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
	
	.center {
		margin: auto;
		width: 50%;
		margin-top: -25px !important
	}
	
	.center-div{
		 margin: 0 auto;
		 width: 100px; 
		 margin-top: -20px !important
	}
		
	body {
      font-family:"avenir next", Arial, sans-serif;
      font-size: 12px;
      color: #696969;
    }

    .ticks {
      font-size: 10px;
    }

    .track,
    .track-inset,
    .track-overlay {
      stroke-linecap: round;
    }

    .track {
      stroke: #000;
      stroke-opacity: 0.3;
      stroke-width: 10px;
    }

    .track-inset {
      stroke: #dcdcdc;
      stroke-width: 8px;
    }

    .track-overlay {
      pointer-events: stroke;
      stroke-width: 50px;
      stroke: transparent;
      
    }

    .handle {
      fill: #fff;
      stroke: #000;
      stroke-opacity: 0.5;
      stroke-width: 1.25px;
    }
		
		
		svg.map{
			display: block;
			margin: auto;
		}
        @import url(http://fonts.googleapis.com/css?family=Oxygen:400,400italic,700);

        .region {
            fill: none;
            stroke: #cfcfcf;
        }

        .d3-tip {
            line-height: 1.5;
            padding: 5px;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            border-radius: 4px;
        }

        .toolTipHead {
            font-size: 14px;
        }

        .toolTipRank {
            font-size: 16px;
            font-weight: bold;
            color: red;
        }

        .toolTipBody {
            font-size: 13px;
        }

        .legendTitle {
            font-size: 1.1rem;
            color: #fff;
            margin-left: -5px;
        }

        #legend {
            position: absolute;
			margin-left:50px;
			margin-top:30px;
        }

        li.key {
            float: left;
            border-top-width: 15px;
            border-top-style: solid;
            font-family: "Oxygen";
            color: #666;
            font-size: 16px;
            width: 10%;
            padding-left: 0;
            padding-right: 0;
            list-style:none;
        }
		.city {
		  font: 10px sans-serif;
		  font-weight: bold;
		  z-index: 2;
		}
		
    </style>
</head>
<body>
	   <div class="navbar-fixed">
		  <nav class="light-blue">
			  <div class="nav-wrapper">
				<a href="#!" class="brand-logo" style="padding-left: 20px;">Mapping health</a>
				<ul class="right hide-on-med-and-down">
				  <li><a class='dropdown-trigger' href='#' data-target='datasetDropdown'>Select dataset<i class="material-icons right">arrow_drop_down</i></a></li>
				  <li><a class='dropdown-trigger' href='#' data-target='sexDropdown'>Select sex<i class="material-icons right">arrow_drop_down</i></a></li>
				  <li><a class='dropdown-trigger' href='#' data-target='yearDropdown'>Select year<i class="material-icons right">arrow_drop_down</i></a></li>
				  <li><a class='dropdown-trigger' href='#' data-target='divisonDropdown'>Administrative divison<i class="material-icons right">arrow_drop_down</i></a></li>
				   <li><a class='dropdown-trigger' href='#' data-target='langDropdown'>Language<i class="material-icons right">arrow_drop_down</i></a></li>
				  <li></li>
				  <li></li>
				</ul>
			  </div>
			</nav>
		</div>
	  
	  <ul id='sexDropdown' class='dropdown-content'>
		<li><a class="sex" value="both" href="#">Both</a></li>
		<li><a class="sex" value="male" href="#">Male</a></li>
		<li><a class="sex" value="female" href="#">Female</a></li>
	  </ul>
	  
	  

	  <ul id='yearDropdown' class='dropdown-content'>
		<li><a class="year" value="2005" href="#">2005</a></li>
		<li><a class="year" value="2010" href="#">2010</a></li>
		<li><a class="year" value="2011" href="#">2011</a></li>
		<li><a class="year" value="2012" href="#">2012</a></li>
		<li><a class="year" value="2013" href="#">2013</a></li>
		<li><a class="year" value="2014" href="#">2014</a></li>
		<li><a class="year" value="2015" href="#">2015</a></li>
		<li><a class="year" value="2016" href="#">2016</a></li>
	  </ul>
	  
	  

	  <ul id='divisonDropdown' class='dropdown-content'>
		<li><a class="divison" value="district" href="#">District</a></li>
		<li><a class="divison" value="region" href="#">Region</a></li>
	  </ul>
	  
	  

	  <ul id='datasetDropdown' class='dropdown-content'>
		<li><a class="m" value="duration" href="#">LifeExpectancy</a></li>
		<li><a class="m" value="morbidity" href="#">Morbidity</a></li>
	  </ul>
	  <ul id='langDropdown' class='dropdown-content'>
		<li><a class="lang" value="ru" href="#">ru</a></li>
		<li><a class="lang" value="en" href="#">en</a></li>
	  </ul>
	
	  <div id="legend"></div>
	  
    <script>
		
		$('.dropdown-trigger').dropdown({ coverTrigger: false });
		var selectedDataSet = "duration";
		var selectedSex = "";
		var selectedYear = "2005";
		if (selectedSex!=="")
		{		
			var selectedValue = selectedDataSet+"_"+selectedSex+"_"+selectedYear;
		}
		else
		{
			var selectedValue = selectedDataSet+"_"+selectedYear;
		}
		var centered;	
  
		var rateByIncome2012 = {};
		var rateByEmployment2012 = {};
		var rateByHealth2012 = {};
		var rateByEducation2012 = {};
		var rateByHousing2012 = {};
		var rateByCrime2012 = {};
		
		var changeSliderFlag = 0;
		var colorFillMinRange=0;
		var colorFillMaxRange=0;
		var cscale;
		
		var rateById = {};
		var rateById2016 = {};
		var duration_2005 = {};
		var duration_2010 = {};
		var duration_2011 = {};
		var duration_2012 = {};
		var duration_2013 = {};
		var duration_2014 = {};
		var duration_2015 = {};
		var duration_2016 = {};
		var duration_male_2005 = {};
		var duration_male_2010 = {};
		var duration_male_2011 = {};
		var duration_male_2012 = {};
		var duration_male_2013 = {};
		var duration_male_2014 = {};
		var duration_male_2015 = {};
		var duration_male_2016 = {};
		var duration_female_2005 = {};
		var duration_female_2010 = {};
		var duration_female_2011 = {};
		var duration_female_2012 = {};
		var duration_female_2013 = {};
		var duration_female_2014 = {};
		var duration_female_2015 = {};
		var duration_female_2016 = {};
		
		var morbidity_2005 = {};
		var morbidity_2010 = {};
		var morbidity_2011 = {};
		var morbidity_2012 = {};
		var morbidity_2013 = {};
		var morbidity_2014 = {};
		var morbidity_2015 = {};
		var morbidity_2016 = {};
		
		var minD2005;
		var minD2010;
		var minD2011;
		var minD2012;
		var minD2013;
		var minD2014;
		var minD2015;
		var minD2016;
		var minDm2005;
		var minDm2010;
		var minDm2011;
		var minDm2012;
		var minDm2013;
		var minDm2014;
		var minDm2015;
		var minDm2016;
		var minDfm2005;
		var minDfm2010;
		var minDfm2011;
		var minDfm2012;
		var minDfm2013;
		var minDfm2014;
		var minDfm2015;
		var minDfm2016;
		var minM2005;
		var minM2010;
		var minM2011;
		var minM2012;
		var minM2013;
		var minM2014;
		var minM2015;
		var minM2016;
		var path ;
		
		var nameById = {};
		
					
		var plot;
		var svgPlot;
		var slider2;
		var g;
		var dataset;
		var margin;
		var scaleLinear;
		var newData;
		<!-- new Promise(function(resolve, reject) { -->

		  <!-- resolve(1);  -->

		<!-- }).then(function() {  -->

		var width = document.documentElement.clientWidth*0.7,
		height = document.documentElement.clientHeight*0.7;
		
		var projection = d3.geoAlbers()
			  .rotate([-105, 0])
			  .center([-10, 65])
			  .parallels([52, 64])
			  .scale(650)
			  .translate([width / 2, height / 2]);
				
			path = d3.geoPath().projection(projection);
		
		var svg = d3.select("body")
			.append("svg")
            .attr("width", width)
            .attr("height", height)
			.attr("class", "map")
            .append("g");
		
		updateChoro(selectedValue);

		<!-- }).then(function() {  -->
			
			<!-- setTimeout(function(){  -->
			
			<!-- d3.tsv("cities.tsv", function(error, data) { -->
			<!-- var city = svg.selectAll("g.city") -->
				<!-- .data(data) -->
				<!-- .enter() -->
				<!-- .append("g") -->
				<!-- .attr("class", "city") -->
				<!-- .attr("transform", function(d) { return "translate(" + projection([d.lon, d.lat]) + ")"; }); -->

				<!-- city.append("circle") -->
				<!-- .attr("r", 3) -->
				<!-- .style("fill", "lime") -->
				<!-- .style("opacity", 1); -->

				<!-- city.append("text") -->
				<!-- .attr("x", 5) -->
				<!-- .text(function(d) { return d.City; }); -->
			<!-- }); -->
			
			<!-- }, 1000); -->
		  
		<!-- }); -->
		
        // wrapper function to enable switching map and legend content
        function updateChoro(choro) {
    
			
			//var path = d3.geoPath();
			
	
			//$( svg).insertBefore( "#slider2" );
	
            // function to read in data from csv file
            d3.csv("duration.csv", function(error, data) {
				
				minD2005=100;
				minD2010=100;
				minD2011=100;
				minD2012=100;
				minD2013=100;
				minD2014=100;
				minD2015=100;
				minD2016=100;
				minDm2005=100;
				minDm2010=100;
				minDm2011=100;
				minDm2012=100;
				minDm2013=100;
				minDm2014=100;
				minDm2015=100;
				minDm2016=100;
				minDfm2005=100;
				minDfm2010=100;
				minDfm2011=100;
				minDfm2012=100;
				minDfm2013=100;
				minDfm2014=100;
				minDfm2015=100;
				minDfm2016=100;
				minM2005=100;
				minM2010=100;
				minM2011=100;
				minM2012=100;
				minM2013=100;
				minM2014=100;
				minM2015=100;
				minM2016=100;
				
				var maxD2005=0;
				var maxD2010=0;
				var maxD2011=0;
				var maxD2012=0;
				var maxD2013=0;
				var maxD2014=0;
				var maxD2015=0;
				var maxD2016=0;
				var maxDm2005=0;
				var maxDm2010=0;
				var maxDm2011=0;
				var maxDm2012=0;
				var maxDm2013=0;
				var maxDm2014=0;
				var maxDm2015=0;
				var maxDm2016=0;
				var maxDfm2005=0;
				var maxDfm2010=0;
				var maxDfm2011=0;
				var maxDfm2012=0;
				var maxDfm2013=0;
				var maxDfm2014=0;
				var maxDfm2015=0;
				var maxDfm2016=0;
				var maxM2005=0;
				var maxM2010=0;
				var maxM2011=0;
				var maxM2012=0;
				var maxM2013=0;
				var maxM2014=0;
				var maxM2015=0;
				var maxM2016=0;
				
				data.forEach(function(d) {
					if (d.Duration_2005<minD2005) minD2005 = Number(d.Duration_2005);
					if (d.Duration_2005>maxD2005) maxD2005 = Number(d.Duration_2005);
					if (d.Duration_2010<minD2010) minD2010 = Number(d.Duration_2010);
					if (d.Duration_2010>maxD2010) maxD2010 = Number(d.Duration_2010);
					if (d.Duration_2011<minD2011) minD2011 = Number(d.Duration_2011);
					if (d.Duration_2011>maxD2011) maxD2011 = Number(d.Duration_2011);
					if (d.Duration_2012<minD2012) minD2012 = Number(d.Duration_2012);
					if (d.Duration_2012>maxD2012) maxD2012 = Number(d.Duration_2012);
					if (d.Duration_2013<minD2013) minD2013 = Number(d.Duration_2013);
					if (d.Duration_2013>maxD2013) maxD2013 = Number(d.Duration_2013);
					if (d.Duration_2014<minD2014) minD2014 = Number(d.Duration_2014);
					if (d.Duration_2014>maxD2014) maxD2014 = Number(d.Duration_2014);
					if (d.Duration_2015<minD2015) minD2015 = Number(d.Duration_2015);
					if (d.Duration_2015>maxD2015) maxD2015 = Number(d.Duration_2015);
					if (d.Duration_2016<minD2016) minD2016 = Number(d.Duration_2016);
					if (d.Duration_2016>maxD2016) maxD2016 = Number(d.Duration_2016);
					
					duration_2005[d.RegionCode] = +d.Duration_2005;

					duration_2010[d.RegionCode] = +d.Duration_2010;
					
					duration_2011[d.RegionCode] = +d.Duration_2011;
					
					duration_2012[d.RegionCode] = +d.Duration_2012;

					duration_2013[d.RegionCode] = +d.Duration_2013;

					duration_2014[d.RegionCode] = +d.Duration_2014;

					duration_2015[d.RegionCode] = +d.Duration_2015;

					duration_2016[d.RegionCode] = +d.Duration_2016;

					if (d.Duration_2005<minDm2005) minDm2005 = Number(d.Duration_2005);
					if (d.Duration_2005>maxDm2005) maxDm2005 = Number(d.Duration_2005);
					if (d.Duration_2010<minDm2010) minDm2010 = Number(d.Duration_2010);
					if (d.Duration_2010>maxDm2010) maxDm2010 = Number(d.Duration_2010);
					if (d.Duration_2011<minDm2011) minDm2011 = Number(d.Duration_2011);
					if (d.Duration_2011>maxDm2011) maxDm2011 = Number(d.Duration_2011);
					if (d.Duration_2012<minDm2012) minDm2012 = Number(d.Duration_2012);
					if (d.Duration_2012>maxDm2012) maxDm2012 = Number(d.Duration_2012);
					if (d.Duration_2013<minDm2013) minDm2013 = Number(d.Duration_2013);
					if (d.Duration_2013>maxDm2013) maxDm2013 = Number(d.Duration_2013);
					if (d.Duration_2014<minDm2014) minDm2014 = Number(d.Duration_2014);
					if (d.Duration_2014>maxDm2014) maxDm2014 = Number(d.Duration_2014);
					if (d.Duration_2015<minDm2015) minDm2015 = Number(d.Duration_2015);
					if (d.Duration_2015>maxDm2015) maxDm2015 = Number(d.Duration_2015);
					if (d.Duration_2016<minDm2016) minDm2016 = Number(d.Duration_2016);
					if (d.Duration_2016>maxDm2016) maxDm2016 = Number(d.Duration_2016);
					
					duration_male_2005[d.RegionCode] = +d.Duration_male_2005;

					duration_male_2010[d.RegionCode] = +d.Duration_male_2010;

					duration_male_2011[d.RegionCode] = +d.Duration_male_2011;

					duration_male_2012[d.RegionCode] = +d.Duration_male_2012;

					duration_male_2013[d.RegionCode] = +d.Duration_male_2013;

					duration_male_2014[d.RegionCode] = +d.Duration_male_2014;

					duration_male_2015[d.RegionCode] = +d.Duration_male_2015;

					duration_male_2016[d.RegionCode] = +d.Duration_male_2016;

					
					if (d.Duration_2005<minDfm2005) minDfm2005 = Number(d.Duration_2005);
					if (d.Duration_2005>maxDfm2005) maxDfm2005 = Number(d.Duration_2005);
					if (d.Duration_2010<minDfm2010) minDfm2010 = Number(d.Duration_2010);
					if (d.Duration_2010>maxDfm2010) maxDfm2010 = Number(d.Duration_2010);
					if (d.Duration_2011<minDfm2011) minDfm2011 = Number(d.Duration_2011);
					if (d.Duration_2011>maxDfm2011) maxDfm2011 = Number(d.Duration_2011);
					if (d.Duration_2012<minDfm2012) minDfm2012 = Number(d.Duration_2012);
					if (d.Duration_2012>maxDfm2012) maxDfm2012 = Number(d.Duration_2012);
					if (d.Duration_2013<minDfm2013) minDfm2013 = Number(d.Duration_2013);
					if (d.Duration_2013>maxDfm2013) maxDfm2013 = Number(d.Duration_2013);
					if (d.Duration_2014<minDfm2014) minDfm2014 = Number(d.Duration_2014);
					if (d.Duration_2014>maxDfm2014) maxDfm2014 = Number(d.Duration_2014);
					if (d.Duration_2015<minDfm2015) minDfm2015 = Number(d.Duration_2015);
					if (d.Duration_2015>maxDfm2015) maxDfm2015 = Number(d.Duration_2015);
					if (d.Duration_2016<minDfm2016) minDfm2016 = Number(d.Duration_2016);
					if (d.Duration_2016>maxDfm2016) maxDfm2016 = Number(d.Duration_2016);
					duration_female_2005[d.RegionCode] = +d.Duration_female_2005;

					duration_female_2010[d.RegionCode] = +d.Duration_female_2010;
					
					
					duration_female_2011[d.RegionCode] = +d.Duration_female_2011;
					
					
					duration_female_2012[d.RegionCode] = +d.Duration_female_2012;
					
					
					duration_female_2013[d.RegionCode] = +d.Duration_female_2013;
					
					
					duration_female_2014[d.RegionCode] = +d.Duration_female_2014;
					
					
					duration_female_2015[d.RegionCode] = +d.Duration_female_2015;
					
					
					duration_female_2016[d.RegionCode] = +d.Duration_female_2016;
					
					
					if (d.Duration_2005<minM2005) minM2005 = Number(d.Duration_2005);
					if (d.Duration_2005>maxM2005) maxM2005 = Number(d.Duration_2005);
					if (d.Duration_2010<minM2010) minM2010 = Number(d.Duration_2010);
					if (d.Duration_2010>maxM2010) maxM2010 = Number(d.Duration_2010);
					if (d.Duration_2011<minM2011) minM2011 = Number(d.Duration_2011);
					if (d.Duration_2011>maxM2011) maxM2011 = Number(d.Duration_2011);
					if (d.Duration_2012<minM2012) minM2012 = Number(d.Duration_2012);
					if (d.Duration_2012>maxM2012) maxM2012 = Number(d.Duration_2012);
					if (d.Duration_2013<minM2013) minM2013 = Number(d.Duration_2013);
					if (d.Duration_2013>maxM2013) maxM2013 = Number(d.Duration_2013);
					if (d.Duration_2014<minM2014) minM2014 = Number(d.Duration_2014);
					if (d.Duration_2014>maxM2014) maxM2014 = Number(d.Duration_2014);
					if (d.Duration_2015<minM2015) minM2015 = Number(d.Duration_2015);
					if (d.Duration_2015>maxM2015) maxM2015 = Number(d.Duration_2015);
					if (d.Duration_2016<minM2016) minM2016 = Number(d.Duration_2016);
					if (d.Duration_2016>maxM2016) maxM2016 = Number(d.Duration_2016);
					
					morbidity_2005[d.RegionCode] = +d.Morbidity_2005;
					
					
					morbidity_2010[d.RegionCode] = +d.Morbidity_2010;
					
					
					morbidity_2011[d.RegionCode] = +d.Morbidity_2011;
					
					
					morbidity_2012[d.RegionCode] = +d.Morbidity_2012;
					
					
					morbidity_2013[d.RegionCode] = +d.Morbidity_2013;
					
					
					morbidity_2014[d.RegionCode] = +d.Morbidity_2014;
					
					
					morbidity_2015[d.RegionCode] = +d.Morbidity_2015;
					
					
					morbidity_2016[d.RegionCode] = +d.Morbidity_2016;
					
					
					nameById[d.RegionCode] = d.RegionName;
				  });
				
	
                // set the colour scale of the choropleth map
                
                var domain;
				var minD ;
                if (choro.indexOf('duration')!== -1) {
					//colorFillMinRange = data[choro].
					
					if (choro == "duration_2005") {
						colorFillMinRange = minD2005;
						colorFillMaxRange = maxD2005;
					}
					if (choro == "duration_2010") {
						colorFillMinRange = minD2010;
						colorFillMaxRange = maxD2010;
					}
					if (choro == "duration_2011") {
						colorFillMinRange = minD2011;
						colorFillMaxRange = maxD2011;
					}
					if (choro == "duration_2012") {
						colorFillMinRange = minD2012;
						colorFillMaxRange = maxD2012;
					}
					if (choro == "duration_2013") {
						colorFillMinRange = minD2013;
						colorFillMaxRange = maxD2013;
					}
					if (choro == "duration_2014") {
						colorFillMinRange = minD2014;
						colorFillMaxRange = maxD2014;
					}
					if (choro == "duration_2015") {
						colorFillMinRange = minD2015;
						colorFillMaxRange = maxD2015;
					}
					if (choro == "duration_2016") {
						colorFillMinRange = minD2016;
						colorFillMaxRange = maxD2016;
					}
					
					
					if (choro == "duration_male_2005") {
						colorFillMinRange = minDm2005;
						colorFillMaxRange = maxDm2005;
					}
					if (choro == "duration_male_2010") {
						colorFillMinRange = minDm2010;
						colorFillMaxRange = maxDm2010;
					}
					if (choro == "duration_male_2011") {
						colorFillMinRange = minDm2011;
						colorFillMaxRange = maxDm2011;
					}
					if (choro == "duration_male_2012") {
						colorFillMinRange = minDm2012;
						colorFillMaxRange = maxDm2012;
					}
					if (choro == "duration_male_2013") {
						colorFillMinRange = minDm2013;
						colorFillMaxRange = maxDm2013;
					}
					if (choro == "duration_male_2014") {
						colorFillMinRange = minDm2014;
						colorFillMaxRange = maxDm2014;
					}
					if (choro == "duration_male_2015") {
						colorFillMinRange = minDm2015;
						colorFillMaxRange = maxDm2015;
					}
					if (choro == "duration_male_2016") {
						colorFillMinRange = minDm2016;
						colorFillMaxRange = maxDm2016;
					}
					
					
					if (choro == "duration_female_2005") {
						colorFillMinRange = minDfm2005;
						colorFillMaxRange = maxDfm2005;
					}
					if (choro == "duration_female_2010") {
						colorFillMinRange = minDfm2010;
						colorFillMaxRange = maxDfm2010;
					}
					if (choro == "duration_female_2011") {
						colorFillMinRange = minDfm2011;
						colorFillMaxRange = maxDfm2011;
					}
					if (choro == "duration_female_2012") {
						colorFillMinRange = minDfm2012;
						colorFillMaxRange = maxDfm2012;
					}
					if (choro == "duration_female_2013") {
						colorFillMinRange = minDfm2013;
						colorFillMaxRange = maxDfm2013;
					}
					if (choro == "duration_female_2014") {
						colorFillMinRange = minDfm2014;
						colorFillMaxRange = maxDfm2014;
					}
					if (choro == "duration_female_2015") {
						colorFillMinRange = minDfm2015;
						colorFillMaxRange = maxDfm2015;
					}
					if (choro == "duration_female_2016") {
						colorFillMinRange = minDfm2016;
						colorFillMaxRange = maxDfm2016;
					}
					
					
					if (choro == "morbidity_2005") {
						colorFillMinRange = minM2005;
						colorFillMaxRange = maxM2005;
					}
					if (choro == "morbidity_2010") {
						colorFillMinRange = minM2010;
						colorFillMaxRange = maxM2010;
					}
					if (choro == "morbidity_2011") {
						colorFillMinRange = minM2011;
						colorFillMaxRange = maxM2011;
					}
					if (choro == "morbidity_2012") {
						colorFillMinRange = minM2012;
						colorFillMaxRange = maxM2012;
					}
					if (choro == "morbidity_2013") {
						colorFillMinRange = minM2013;
						colorFillMaxRange = maxM2013;
					}
					if (choro == "morbidity_2014") {
						colorFillMinRange = minM2014;
						colorFillMaxRange = maxM2014;
					}
					if (choro == "morbidity_2015") {
						colorFillMinRange = minM2015;
						colorFillMaxRange = maxM2015;
					}
					if (choro == "morbidity_2016") {
						colorFillMinRange = minM2016;
						colorFillMaxRange = maxM2016;
					}
					
                    cscale = colorbrewer.Rainbow[9]
                    document.getElementById("legend").innerHTML="<span class = 'card-panel light-blue legendTitle'>" + "Life expectancy" + " " + selectedValue.substring(selectedValue.indexOf("_")+1) + "</span>";
                }
                if (choro == "Morbidity") {
                    choro = rateByIncome2012;
                    cscale = colorbrewer.Oranges[9]
                    domain = 'Income '
                    document.getElementById("legend").innerHTML="<span class = legendTitle>" + domain + "</span>";
                }
				
				if (changeSliderFlag>0) colorFillMinRange = changeSliderFlag;
                var color = d3.scaleQuantize()
                    .domain([colorFillMinRange, colorFillMaxRange])
                    .range(cscale);
					//console.log(color);
				  
			    var tip = d3.tip()
					.attr('class', 'd3-tip')
					.offset([0, 10])
					.direction(function(d) {
					return 'e'
						//if (rateById[d.properties.region] <= '15010124') {return 'n'}
						//if (rateById[d.properties.region] >= '15010125') {return 's'}
						//else {return 'e'}
					;})
					.html(function (d) {

						if (choro == "duration_2005") {
							var y2015 = duration_2005[d.properties.region]
						}
						if (choro == "duration_2010") {
							var y2015 = duration_2010[d.properties.region]
						}
						if (choro == "duration_2011") {
							var y2015 = duration_2011[d.properties.region]
						}
						if (choro == "duration_2012") {
							var y2015 = duration_2012[d.properties.region]
						}
						if (choro == "duration_2013") {
							var y2015 = duration_2013[d.properties.region]
						}
						if (choro == "duration_2014") {
							var y2015 = duration_2014[d.properties.region]
						}
						if (choro == "duration_2015") {
							var y2015 = duration_2015[d.properties.region]
						}
						if (choro == "duration_2016") {
							var y2015 = duration_2016[d.properties.region]
						}
						
						if (choro == "duration_male_2005") {
							var y2015 = duration_male_2005[d.properties.region]
						}
						if (choro == "duration_male_2010") {
							var y2015 = duration_male_2010[d.properties.region]
						}
						if (choro == "duration_male_2011") {
							var y2015 = duration_male_2011[d.properties.region]
						}
						if (choro == "duration_male_2012") {
							var y2015 = duration_male_2012[d.properties.region]
						}
						if (choro == "duration_male_2013") {
							var y2015 = duration_male_2013[d.properties.region]
						}
						if (choro == "duration_male_2014") {
							var y2015 = duration_male_2014[d.properties.region]
						}
						if (choro == "duration_male_2015") {
							var y2015 = duration_male_2015[d.properties.region]
						}
						if (choro == "duration_male_2016") {
							var y2015 = duration_male_2016[d.properties.region]
						}
						
						if (choro == "duration_female_2005") {
							var y2015 = duration_female_2005[d.properties.region]
						}
						if (choro == "duration_female_2010") {
							var y2015 = duration_female_2010[d.properties.region]
						}
						if (choro == "duration_female_2011") {
							var y2015 = duration_female_2011[d.properties.region]
						}
						if (choro == "duration_female_2012") {
							var y2015 = duration_female_2012[d.properties.region]
						}
						if (choro == "duration_female_2013") {
							var y2015 = duration_female_2013[d.properties.region]
						}
						if (choro == "duration_female_2014") {
							var y2015 = duration_female_2014[d.properties.region]
						}
						if (choro == "duration_female_2015") {
							var y2015 = duration_female_2015[d.properties.region]
						}
						if (choro == "duration_female_2016") {
							var y2015 = duration_female_2016[d.properties.region]
						}
						
						if (choro == "duration_female_2005") {
							var y2015 = duration_female_2005[d.properties.region]
						}
						if (choro == "duration_female_2010") {
							var y2015 = duration_female_2010[d.properties.region]
						}
						if (choro == "duration_female_2011") {
							var y2015 = duration_female_2011[d.properties.region]
						}
						if (choro == "duration_female_2012") {
							var y2015 = duration_female_2012[d.properties.region]
						}
						if (choro == "duration_female_2013") {
							var y2015 = duration_female_2013[d.properties.region]
						}
						if (choro == "duration_female_2014") {
							var y2015 = duration_female_2014[d.properties.region]
						}
						if (choro == "duration_female_2015") {
							var y2015 = duration_female_2015[d.properties.region]
						}
						if (choro == "duration_female_2016") {
							var y2015 = duration_female_2016[d.properties.region]
						}
						
						if (choro == "morbidity_2005") {
							var y2015 = morbidity_2005[d.properties.region]
						}
						if (choro == "morbidity_2010") {
							var y2015 = morbidity_2010[d.properties.region]
						}
						if (choro == "morbidity_2011") {
							var y2015 = morbidity_2011[d.properties.region]
						}
						if (choro == "morbidity_2012") {
							var y2015 = morbidity_2012[d.properties.region]
						}
						if (choro == "morbidity_2013") {
							var y2015 = morbidity_2013[d.properties.region]
						}
						if (choro == "morbidity_2014") {
							var y2015 = morbidity_2014[d.properties.region]
						}
						if (choro == "morbidity_2015") {
							var y2015 = morbidity_2015[d.properties.region]
						}
						if (choro == "morbidity_2016") {
							var y2015 = morbidity_2016[d.properties.region]
						}

						return "<span class ='toolTipHead'>" +
						//"<b>Data Zone: " + d.id + "</b><br/>" +
						"Intermediate Geography: " + nameById[d.properties.region] + "<br/>" +
						//"<span class ='toolTipRank'>Current " + domain + "SIMD Rank: " + y2015 + "</span><br/>" +
						//"Rank history (2004 - 2012)<br/>" +
						"2015: " + y2015 + "<br/>";
					})
    
                // function to read in data from json file
                d3.json("russia_1e-7sr.json", function(error, S12000046_topo) {
    
                    // build the tool tip information boxes
                    
                    svg.call(tip);
    
                    d3.select("g")
                        .selectAll("path")
                        .remove();
					
					var appending = svg.append("g")
						.attr("class", "region")
						.selectAll("g")
						.data(topojson.feature(S12000046_topo, S12000046_topo.objects.russia).features)
						.enter().append("path")
						
	
                    // build the choropleth map
                    /*var appending = svg.selectAll("g")
                        .attr("class", "region")
						.data(topojson.feature(S12000046_topo, S12000046_topo.objects.russia).features)
                        //.data(topojson.feature(S12000046_topo, S12000046_topo.objects.S12000046_geo).features);
    
                        // add new elements
						*/
                        appending.enter().append("path");
						
                        // update existing elements
                        appending.style("fill",
                        function (d) {
							let col;
                            //return color(choro[d.id]);
							if (choro == "duration_2005") {
								col=color(duration_2005[d.properties.region]); 
							}
							if (choro == "duration_2010") {
								col=color(duration_2010[d.properties.region]); 
							}
							if (choro == "duration_2011") {
								col=color(duration_2011[d.properties.region]); 
							}
							if (choro == "duration_2012") {
								col=color(duration_2012[d.properties.region]); 
							}
							if (choro == "duration_2013") {
								col=color(duration_2013[d.properties.region]); 
							}
							if (choro == "duration_2014") {
								col=color(duration_2014[d.properties.region]); 
							}
							if (choro == "duration_2015") {
								col=color(duration_2015[d.properties.region]); 
							}
							if (choro == "duration_2016") {
								col=color(duration_2016[d.properties.region]); 
							}
							
							if (choro == "duration_male_2005") {
								col=color(duration_male_2005[d.properties.region]); 
							}
							if (choro == "duration_male_2010") {
								col=color(duration_male_2010[d.properties.region]); 
							}
							if (choro == "duration_male_2011") {
								col=color(duration_male_2011[d.properties.region]); 
							}
							if (choro == "duration_male_2012") {
								col=color(duration_male_2012[d.properties.region]); 
							}
							if (choro == "duration_male_2013") {
								col=color(duration_male_2013[d.properties.region]); 
							}
							if (choro == "duration_male_2014") {
								col=color(duration_male_2014[d.properties.region]); 
							}
							if (choro == "duration_male_2015") {
								col=color(duration_male_2015[d.properties.region]); 
							}
							if (choro == "duration_male_2016") {
								col=color(duration_male_2016[d.properties.region]); 
							}
							
							if (choro == "duration_female_2005") {
								col=color(duration_female_2005[d.properties.region]); 
							}
							if (choro == "duration_female_2010") {
								col=color(duration_female_2010[d.properties.region]); 
							}
							if (choro == "duration_female_2011") {
								col=color(duration_female_2011[d.properties.region]); 
							}
							if (choro == "duration_female_2012") {
								col=color(duration_female_2012[d.properties.region]); 
							}
							if (choro == "duration_female_2013") {
								col=color(duration_female_2013[d.properties.region]); 
							}
							if (choro == "duration_female_2014") {
								col=color(duration_female_2014[d.properties.region]); 
							}
							if (choro == "duration_female_2015") {
								col=color(duration_female_2015[d.properties.region]); 
							}
							if (choro == "duration_female_2016") {
								col=color(duration_female_2016[d.properties.region]); 
							}
							
							if (choro == "morbidity_2005") {
							col=color(morbidity_2005[d.properties.region]); 
							}
							if (choro == "morbidity_2010") {
								col=color(morbidity_2010[d.properties.region]); 
							}
							if (choro == "morbidity_2011") {
								col=color(morbidity_2011[d.properties.region]); 
							}
							if (choro == "morbidity_2012") {
								col=color(morbidity_2012[d.properties.region]); 
							}
							if (choro == "morbidity_2013") {
								col=color(morbidity_2013[d.properties.region]); 
							}
							if (choro == "morbidity_2014") {
								col=color(morbidity_2014[d.properties.region]); 
							}
							if (choro == "morbidity_2015") {
								col=color(morbidity_2015[d.properties.region]); 
							}
							if (choro == "morbidity_2016") {
								col=color(morbidity_2016[d.properties.region]); 
							}

							return col; 
                        })
						.style("opacity", 0.8)
                        //.style("stroke", "white")
                        .style("stroke-width", 0.3)
                        .attr("d", path)
						.attr("class", function(d) { 
						return d.properties.region;} 
						)
                        .on("click", clicked)
    
                        // rollover functionality to display tool tips
                        .on("mouseover", function (d) {
                            tip.show(d)
                            d3.select(this)
                                .transition().duration(200)
                                .style("fill", "red");
                        })
                        .on("mouseout", function () {
                            tip.hide()
                            d3.select(this)
                                .transition().duration(200)
                                .style("fill",
                                function (d) {
								
							let col;
                            //return color(choro[d.id]);
							if (choro == "duration_2005") {
								col=color(duration_2005[d.properties.region]); 
							}
							if (choro == "duration_2010") {
								col=color(duration_2010[d.properties.region]); 
							}
							if (choro == "duration_2011") {
								col=color(duration_2011[d.properties.region]); 
							}
							if (choro == "duration_2012") {
								col=color(duration_2012[d.properties.region]); 
							}
							if (choro == "duration_2013") {
								col=color(duration_2013[d.properties.region]); 
							}
							if (choro == "duration_2014") {
								col=color(duration_2014[d.properties.region]); 
							}
							if (choro == "duration_2015") {
								col=color(duration_2015[d.properties.region]); 
							}
							if (choro == "duration_2016") {
								col=color(duration_2016[d.properties.region]); 
							}
							
							if (choro == "duration_male_2005") {
								col=color(duration_male_2005[d.properties.region]); 
							}
							if (choro == "duration_male_2010") {
								col=color(duration_male_2010[d.properties.region]); 
							}
							if (choro == "duration_male_2011") {
								col=color(duration_male_2011[d.properties.region]); 
							}
							if (choro == "duration_male_2012") {
								col=color(duration_male_2012[d.properties.region]); 
							}
							if (choro == "duration_male_2013") {
								col=color(duration_male_2013[d.properties.region]); 
							}
							if (choro == "duration_male_2014") {
								col=color(duration_male_2014[d.properties.region]); 
							}
							if (choro == "duration_male_2015") {
								col=color(duration_male_2015[d.properties.region]); 
							}
							if (choro == "duration_male_2016") {
								col=color(duration_male_2016[d.properties.region]); 
							}
							
							if (choro == "duration_female_2005") {
								col=color(duration_female_2005[d.properties.region]); 
							}
							if (choro == "duration_female_2010") {
								col=color(duration_female_2010[d.properties.region]); 
							}
							if (choro == "duration_female_2011") {
								col=color(duration_female_2011[d.properties.region]); 
							}
							if (choro == "duration_female_2012") {
								col=color(duration_female_2012[d.properties.region]); 
							}
							if (choro == "duration_female_2013") {
								col=color(duration_female_2013[d.properties.region]); 
							}
							if (choro == "duration_female_2014") {
								col=color(duration_female_2014[d.properties.region]); 
							}
							if (choro == "duration_female_2015") {
								col=color(duration_female_2015[d.properties.region]); 
							}
							if (choro == "duration_female_2016") {
								col=color(duration_female_2016[d.properties.region]); 
							}
							
							if (choro == "morbidity_2005") {
								col=color(morbidity_2005[d.properties.region]); 
							}
							if (choro == "morbidity_2010") {
								col=color(morbidity_2010[d.properties.region]); 
							}
							if (choro == "morbidity_2011") {
								col=color(morbidity_2011[d.properties.region]); 
							}
							if (choro == "morbidity_2012") {
								col=color(morbidity_2012[d.properties.region]); 
							}
							if (choro == "morbidity_2013") {
								col=color(morbidity_2013[d.properties.region]); 
							}
							if (choro == "morbidity_2014") {
								col=color(morbidity_2014[d.properties.region]); 
							}
							if (choro == "morbidity_2015") {
								col=color(morbidity_2015[d.properties.region]); 
							}
							if (choro == "morbidity_2016") {
								col=color(morbidity_2016[d.properties.region]); 
							}

							return col; 

                                });
                        })
							
                })
				
				<!-- d3.select("g") -->
                        <!-- .selectAll("text") -->
                        <!-- .remove(); -->
						
				<!-- d3.select("g") -->
                        <!-- .selectAll("circle") -->
                        <!-- .remove(); -->
						
				setTimeout(function(){ 
			
					 d3.select("g")
                        .selectAll(".city")
                        .remove();
			
					d3.tsv("cities.tsv", function(error, data) {
					var city = svg.selectAll("g.city")
						.data(data)
						.enter()
						.append("g")
						.attr("class", "city")
						.attr("transform", function(d) { return "translate(" + projection([d.lon, d.lat]) + ")"; });

						city.append("circle")
						.attr("r", 3)
						.style("fill", "lime")
						.style("opacity", 1);

						city.append("text")
						.attr("x", 5)
						.text(function(d) { return d.City; });
					});
					
					if (changeSliderFlag==0) 
					{
						drawSlider();
					}
					
					}, 100);
				
            })
			//if (changeSliderFlag==0) {
			//	drawSlider();
				//drawPlot(original_dataset);
			//}
			
        }
    
        function clicked(d) {
            var x, y, k;
    
            if (d && centered !== d) {
                var centroid = path.centroid(d);
                x = centroid[0];
                y = centroid[1];
                k = 4;
                centered = d;
            } else {
                x = width / 2;
                y = height / 2;
                k = 1;
                centered = null;
            }
    
            svg.selectAll("path")
				.classed("active", centered && function(d) { return d === centered; });
    
            svg.transition()
				.duration(750)
				.attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
				.style("stroke-width", 1.5 / k + "px");
        }
    
        // generate initial map using overall deprivation rank data
        
        // handle on click event to switch between maps
        d3.selectAll(".m")
			.on("click", function() {
				
				selectedDataSet = this.getAttribute("value");
				
				if (selectedSex!=="")
				{		
					selectedValue = selectedDataSet+"_"+selectedSex+"_"+selectedYear;
				}
				else
				{
					selectedValue = selectedDataSet+"_"+selectedYear;
				}
				
				d3.select("g").selectAll("#slider2").remove();
				changeSliderFlag = 0;
				updateChoro(selectedValue);
		});
		
		d3.selectAll(".year")
			.on("click", function() {				
				
				selectedYear = this.getAttribute("value");
				
				if (selectedSex!=="")
				{		
					selectedValue = selectedDataSet+"_"+selectedSex+"_"+selectedYear;
				}
				else
				{
					selectedValue = selectedDataSet+"_"+selectedYear;
				}
				
				changeSliderFlag = 0;
				updateChoro(selectedValue);
		});
		
		d3.selectAll(".sex")
			.on("click", function() {

				if (this.getAttribute("value")==="both")
				{
					selectedSex = "";
				}
				else
				{
					selectedSex = this.getAttribute("value");	
				}
				
				selectedValue = selectedDataSet+"_"+selectedSex+"_"+selectedYear;
				changeSliderFlag = 0;
				updateChoro(selectedValue);
		});

function drawSlider() {

d3.select("#slider2").remove();
d3.select("#vis").remove();

var div = d3.select("body")
			.append("div").attr("id","slider2").attr("class","center-div");
var vis = d3.select("body")
			.append("div").attr("id","vis").attr("class","center-div");
/*
var svg = d3.select("body")
			.append("svg")
            .attr("width", width)
            .attr("height", height)
			.attr("class", "map")
            .append("g");
*/
slider2 = d3.sliderHorizontal()
    .min(colorFillMinRange)
    .max(colorFillMaxRange)
    .step(1)
    .width(300)
    .on('onchange', val => {
      update(val); 
	  d3.select("p#value2").text(val);
    });

  g = d3.select("div#slider2").append("svg")
    .attr("width", 500)
    .attr("height", 100)
    .append("g")
    .attr("transform", "translate(30,30)");

  g.call(slider2);

  d3.select("p#value2").text((slider2.value()));
  
margin = {top:0, right:50, bottom:0, left:50},
    width = 300 ,
    height = 100 - margin.top - margin.bottom;

////////// slider //////////

scaleLinear = d3.scaleLinear()
    .domain([colorFillMinRange, colorFillMaxRange])
    .range([0, 300])
    .clamp(true);

////////// plot //////////

svgPlot = d3.select("#vis")
    .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", 80);

plot = svgPlot.append("g")
    .attr("class", "plot")
    .attr("transform", "translate(" + 30 + "," + margin.top + ")");
    

d3.csv("duration.csv", function(data) {
  dataset = data;
  drawPlot(dataset);
})};

function drawPlot(data) {
	
	plot.selectAll(".location").remove();
	
	var color = d3.scaleQuantize()
                    .domain([colorFillMinRange, colorFillMaxRange])
                    .range(cscale);
					
	var locations = plot.selectAll(".location")
    .data(data)
    .enter()
    .append("circle")
	
    .attr("class", "location")
    .attr("cx", function(d) { 
		
		let col;
		if (selectedValue == "duration_2005") {
			col=d.Duration_2005;
		}
		if (selectedValue == "duration_2010") {
			col=d.Duration_2010;
		}
		if (selectedValue == "duration_2011") {
			col=d.Duration_2011;
		}
		if (selectedValue == "duration_2012") {
			col=d.Duration_2012;
		}
		if (selectedValue == "duration_2013") {
			col=d.Duration_2013;
		}
		if (selectedValue == "duration_2014") {
			col=d.Duration_2014;
		}
		if (selectedValue == "duration_2015") {
			col=d.Duration_2015;
		}
		if (selectedValue == "duration_2016") {
			col=d.Duration_2016;
		}
		
		if (selectedValue == "duration_male_2005") {
			col=d.Duration_male_2005;
		}
		if (selectedValue == "duration_male_2010") {
			col=d.Duration_male_2010;
		}
		if (selectedValue == "duration_male_2011") {
			col=d.Duration_male_2011;
		}
		if (selectedValue == "duration_male_2012") {
			col=d.Duration_male_2012;
		}
		if (selectedValue == "duration_male_2013") {
			col=d.Duration_male_2013;
		}
		if (selectedValue == "duration_male_2014") {
			col=d.Duration_male_2014;
		}
		if (selectedValue == "duration_male_2015") {
			col=d.Duration_male_2015;
		}
		if (selectedValue == "duration_male_2016") {
			col=d.Duration_male_2016;
		}
		
		if (selectedValue == "duration_female_2005") {
			col=d.Duration_female_2005;
		}
		if (selectedValue == "duration_female_2010") {
			col=d.Duration_female_2010;
		}
		if (selectedValue == "duration_female_2011") {
			col=d.Duration_female_2011;
		}
		if (selectedValue == "duration_female_2012") {
			col=d.Duration_female_2012;
		}
		if (selectedValue == "duration_female_2013") {
			col=d.Duration_female_2013;
		}
		if (selectedValue == "duration_female_2014") {
			col=d.Duration_female_2014;
		}
		if (selectedValue == "duration_female_2015") {
			col=d.Duration_female_2015;
		}
		if (selectedValue == "duration_female_2016") {
			col=d.Duration_female_2016;
		}
		
		if (selectedValue == "morbidity_2005") {
			col=d.Morbidity_2005;
		}
		if (selectedValue == "morbidity_2010") {
			col=d.Morbidity_2010;
		}
		if (selectedValue == "morbidity_2011") {
			col=d.Morbidity_2011;
		}
		if (selectedValue == "morbidity_2012") {
			col=d.Morbidity_2012;
		}
		if (selectedValue == "morbidity_2013") {
			col=d.Morbidity_2013;
		}
		if (selectedValue == "morbidity_2014") {
			col=d.Morbidity_2014;
		}
		if (selectedValue == "morbidity_2015") {
			col=d.Morbidity_2015;
		}
		if (selectedValue == "morbidity_2016") {
			col=d.Morbidity_2016;
		}
		return scaleLinear(col);

	})
    .attr("cy", height/4)
	
	.on("mouseover", function (d) {
								d3.select(this).style("fill", "red");
								d3.selectAll("."+d.RegionCode).style("fill", "red");
								
                        })
	.on("mouseout", function (d) {
		d3.select(this).style("fill", function (d) {
		
			let col;
			if (selectedValue == "duration_2005") {
				col=color(d.Duration_2005); 
			}
			if (selectedValue == "duration_2010") {
				col=color(d.Duration_2010); 
			}
			if (selectedValue == "duration_2011") {
				col=color(d.Duration_2011); 
			}
			if (selectedValue == "duration_2012") {
				col=color(d.Duration_2012); 
			}
			if (selectedValue == "duration_2013") {
				col=color(d.Duration_2013); 
			}
			if (selectedValue == "duration_2014") {
				col=color(d.Duration_2014); 
			}
			if (selectedValue == "duration_2015") {
				col=color(d.Duration_2015); 
			}
			if (selectedValue == "duration_2016") {
				col=color(d.Duration_2016); 
			}
			
			if (selectedValue == "duration_male_2005") {
				col=color(d.Duration_male_2005); 
			}
			if (selectedValue == "duration_male_2010") {
				col=color(d.Duration_male_2010); 
			}
			if (selectedValue == "duration_male_2011") {
				col=color(d.Duration_male_2011); 
			}
			if (selectedValue == "duration_male_2012") {
				col=color(d.Duration_male_2012); 
			}
			if (selectedValue == "duration_male_2013") {
				col=color(d.Duration_male_2013); 
			}
			if (selectedValue == "duration_male_2014") {
				col=color(d.Duration_male_2014); 
			}
			if (selectedValue == "duration_male_2015") {
				col=color(d.Duration_male_2015); 
			}
			if (selectedValue == "duration_male_2016") {
				col=color(d.Duration_male_2016); 
			}
			
			if (selectedValue == "duration_female_2005") {
				col=color(d.Duration_female_2005); 
			}
			if (selectedValue == "duration_female_2010") {
				col=color(d.Duration_female_2010); 
			}
			if (selectedValue == "duration_female_2011") {
				col=color(d.Duration_female_2011); 
			}
			if (selectedValue == "duration_female_2012") {
				col=color(d.Duration_female_2012); 
			}
			if (selectedValue == "duration_female_2013") {
				col=color(d.Duration_female_2013); 
			}
			if (selectedValue == "duration_female_2014") {
				col=color(d.Duration_female_2014); 
			}
			if (selectedValue == "duration_female_2015") {
				col=color(d.Duration_female_2015); 
			}
			if (selectedValue == "duration_female_2016") {
				col=color(d.Duration_female_2016); 
			}
			
			if (selectedValue == "morbidity_2005") {
				col=color(d.Morbidity_2005); 
			}
			if (selectedValue == "morbidity_2010") {
				col=color(d.Morbidity_2010); 
			}
			if (selectedValue == "morbidity_2011") {
				col=color(d.Morbidity_2011); 
			}
			if (selectedValue == "morbidity_2012") {
				col=color(d.Morbidity_2012); 
			}
			if (selectedValue == "morbidity_2013") {
				col=color(d.Morbidity_2013); 
			}
			if (selectedValue == "morbidity_2014") {
				col=color(d.Morbidity_2014); 
			}
			if (selectedValue == "morbidity_2015") {
				col=color(d.Morbidity_2015); 
			}
			if (selectedValue == "morbidity_2016") {
				col=color(d.Morbidity_2016); 
			}

			return col; 

			//let col=color([d.Duration_2005]); 
		});
		
		d3.selectAll("."+d.RegionCode).style("fill", function (d) {
			let col;
			if (selectedValue == "duration_2005") {
				col=color(duration_2005[d.properties.region]); 
			}
			if (selectedValue == "duration_2010") {
				col=color(duration_2010[d.properties.region]); 
			}
			if (selectedValue == "duration_2011") {
				col=color(duration_2011[d.properties.region]); 
			}
			if (selectedValue == "duration_2012") {
				col=color(duration_2012[d.properties.region]); 
			}
			if (selectedValue == "duration_2013") {
				col=color(duration_2013[d.properties.region]); 
			}
			if (selectedValue == "duration_2014") {
				col=color(duration_2014[d.properties.region]); 
			}
			if (selectedValue == "duration_2015") {
				col=color(duration_2015[d.properties.region]); 
			}
			if (selectedValue == "duration_2016") {
				col=color(duration_2016[d.properties.region]); 
			}
			
			if (selectedValue == "duration_male_2005") {
				col=color(duration_male_2005[d.properties.region]); 
			}
			if (selectedValue == "duration_male_2010") {
				col=color(duration_male_2010[d.properties.region]); 
			}
			if (selectedValue == "duration_male_2011") {
				col=color(duration_male_2011[d.properties.region]); 
			}
			if (selectedValue == "duration_male_2012") {
				col=color(duration_male_2012[d.properties.region]); 
			}
			if (selectedValue == "duration_male_2013") {
				col=color(duration_male_2013[d.properties.region]); 
			}
			if (selectedValue == "duration_male_2014") {
				col=color(duration_male_2014[d.properties.region]); 
			}
			if (selectedValue == "duration_male_2015") {
				col=color(duration_male_2015[d.properties.region]); 
			}
			if (selectedValue == "duration_male_2016") {
				col=color(duration_male_2016[d.properties.region]); 
			}
			
			if (selectedValue == "duration_female_2005") {
				col=color(duration_female_2005[d.properties.region]); 
			}
			if (selectedValue == "duration_female_2010") {
				col=color(duration_female_2010[d.properties.region]); 
			}
			if (selectedValue == "duration_female_2011") {
				col=color(duration_female_2011[d.properties.region]); 
			}
			if (selectedValue == "duration_female_2012") {
				col=color(duration_female_2012[d.properties.region]); 
			}
			if (selectedValue == "duration_female_2013") {
				col=color(duration_female_2013[d.properties.region]); 
			}
			if (selectedValue == "duration_female_2014") {
				col=color(duration_female_2014[d.properties.region]); 
			}
			if (selectedValue == "duration_female_2015") {
				col=color(duration_female_2015[d.properties.region]); 
			}
			if (selectedValue == "duration_female_2016") {
				col=color(duration_female_2016[d.properties.region]); 
			}
			
			if (selectedValue == "morbidity_2005") {
				col=color(morbidity_2005[d.properties.region]); 
			}
			if (selectedValue == "morbidity_2010") {
				col=color(morbidity_2010[d.properties.region]); 
			}
			if (selectedValue == "morbidity_2011") {
				col=color(morbidity_2011[d.properties.region]); 
			}
			if (selectedValue == "morbidity_2012") {
				col=color(morbidity_2012[d.properties.region]); 
			}
			if (selectedValue == "morbidity_2013") {
				col=color(morbidity_2013[d.properties.region]); 
			}
			if (selectedValue == "morbidity_2014") {
				col=color(morbidity_2014[d.properties.region]); 
			}
			if (selectedValue == "morbidity_2015") {
				col=color(morbidity_2015[d.properties.region]); 
			}
			if (selectedValue == "morbidity_2016") {
				col=color(morbidity_2016[d.properties.region]); 
			}

			return col; 
		});
})
	
    .style("fill",function (d) {
			let col;
			if (selectedValue == "duration_2005") {
				col=color(d.Duration_2005); 
			}
			if (selectedValue == "duration_2010") {
				col=color(d.Duration_2010); 
			}
			if (selectedValue == "duration_2011") {
				col=color(d.Duration_2011); 
			}
			if (selectedValue == "duration_2012") {
				col=color(d.Duration_2012); 
			}
			if (selectedValue == "duration_2013") {
				col=color(d.Duration_2013); 
			}
			if (selectedValue == "duration_2014") {
				col=color(d.Duration_2014); 
			}
			if (selectedValue == "duration_2015") {
				col=color(d.Duration_2015); 
			}
			if (selectedValue == "duration_2016") {
				col=color(d.Duration_2016); 
			}
			
			if (selectedValue == "duration_male_2005") {
				col=color(d.Duration_male_2005); 
			}
			if (selectedValue == "duration_male_2010") {
				col=color(d.Duration_male_2010); 
			}
			if (selectedValue == "duration_male_2011") {
				col=color(d.Duration_male_2011); 
			}
			if (selectedValue == "duration_male_2012") {
				col=color(d.Duration_male_2012); 
			}
			if (selectedValue == "duration_male_2013") {
				col=color(d.Duration_male_2013); 
			}
			if (selectedValue == "duration_male_2014") {
				col=color(d.Duration_male_2014); 
			}
			if (selectedValue == "duration_male_2015") {
				col=color(d.Duration_male_2015); 
			}
			if (selectedValue == "duration_male_2016") {
				col=color(d.Duration_male_2016); 
			}
			
			if (selectedValue == "duration_female_2005") {
				col=color(d.Duration_female_2005); 
			}
			if (selectedValue == "duration_female_2010") {
				col=color(d.Duration_female_2010); 
			}
			if (selectedValue == "duration_female_2011") {
				col=color(d.Duration_female_2011); 
			}
			if (selectedValue == "duration_female_2012") {
				col=color(d.Duration_female_2012); 
			}
			if (selectedValue == "duration_female_2013") {
				col=color(d.Duration_female_2013); 
			}
			if (selectedValue == "duration_female_2014") {
				col=color(d.Duration_female_2014); 
			}
			if (selectedValue == "duration_female_2015") {
				col=color(d.Duration_female_2015); 
			}
			if (selectedValue == "duration_female_2016") {
				col=color(d.Duration_female_2016); 
			}
			
			if (selectedValue == "morbidity_2005") {
				col=color(d.Morbidity_2005); 
			}
			if (selectedValue == "morbidity_2010") {
				col=color(d.Morbidity_2010); 
			}
			if (selectedValue == "morbidity_2011") {
				col=color(d.Morbidity_2011); 
			}
			if (selectedValue == "morbidity_2012") {
				col=color(d.Morbidity_2012); 
			}
			if (selectedValue == "morbidity_2013") {
				col=color(d.Morbidity_2013); 
			}
			if (selectedValue == "morbidity_2014") {
				col=color(d.Morbidity_2014); 
			}
			if (selectedValue == "morbidity_2015") {
				col=color(d.Morbidity_2015); 
			}
			if (selectedValue == "morbidity_2016") {
				col=color(d.Morbidity_2016); 
			}

			return col; 
		})
    .style("stroke", function(d) { 
	
		let col;
		if (selectedValue == "duration_2005") {
			col=d.Duration_2005;
		}
		if (selectedValue == "duration_2010") {
			col=d.Duration_2010;
		}
		if (selectedValue == "duration_2011") {
			col=d.Duration_2011;
		}
		if (selectedValue == "duration_2012") {
			col=d.Duration_2012;
		}
		if (selectedValue == "duration_2013") {
			col=d.Duration_2013;
		}
		if (selectedValue == "duration_2014") {
			col=d.Duration_2014;
		}
		if (selectedValue == "duration_2015") {
			col=d.Duration_2015;
		}
		if (selectedValue == "duration_2016") {
			col=d.Duration_2016;
		}
		
		if (selectedValue == "duration_male_2005") {
			col=d.Duration_male_2005;
		}
		if (selectedValue == "duration_male_2010") {
			col=d.Duration_male_2010;
		}
		if (selectedValue == "duration_male_2011") {
			col=d.Duration_male_2011;
		}
		if (selectedValue == "duration_male_2012") {
			col=d.Duration_male_2012;
		}
		if (selectedValue == "duration_male_2013") {
			col=d.Duration_male_2013;
		}
		if (selectedValue == "duration_male_2014") {
			col=d.Duration_male_2014;
		}
		if (selectedValue == "duration_male_2015") {
			col=d.Duration_male_2015;
		}
		if (selectedValue == "duration_male_2016") {
			col=d.Duration_male_2016;
		}
		
		if (selectedValue == "duration_female_2005") {
			col=d.Duration_female_2005; 
		}
		if (selectedValue == "duration_female_2010") {
			col=d.Duration_female_2010; 
		}
		if (selectedValue == "duration_female_2011") {
			col=d.Duration_female_2011;
		}
		if (selectedValue == "duration_female_2012") {
			col=d.Duration_female_2012;
		}
		if (selectedValue == "duration_female_2013") {
			col=d.Duration_female_2013;
		}
		if (selectedValue == "duration_female_2014") {
			col=d.Duration_female_2014;
		}
		if (selectedValue == "duration_female_2015") {
			col=d.Duration_female_2015;
		}
		if (selectedValue == "duration_female_2016") {
			col=d.Duration_female_2016;
		}
		
		if (selectedValue == "morbidity_2005") {
			col=d.Morbidity_2005;
		}
		if (selectedValue == "morbidity_2010") {
			col=d.Morbidity_2010;
		}
		if (selectedValue == "morbidity_2011") {
			col=d.Morbidity_2011;
		}
		if (selectedValue == "morbidity_2012") {
			col=d.Morbidity_2012;
		}
		if (selectedValue == "morbidity_2013") {
			col=d.Morbidity_2013;
		}
		if (selectedValue == "morbidity_2014") {
			col=d.Morbidity_2014;
		}
		if (selectedValue == "morbidity_2015") {
			col=d.Morbidity_2015;
		}
		if (selectedValue == "morbidity_2016") {
			col=d.Morbidity_2016;
		}

		return col; 
	
	})
    .style("opacity", 0.8)
    .attr("r", 8)
      .transition()
      .duration(600)
      .attr("r", 25)
      .transition()
	  .attr("class1", function(d) { return d.RegionCode; })
      .attr("r", 8);
	  

}

function update(h) {
  // filter data set and redraw plot
  newData = dataset.filter(function(d) {
	let col;
	if (selectedValue == "duration_2005") {
		col=d.Duration_2005;
	}
	if (selectedValue == "duration_2010") {
		col=d.Duration_2010;
	}
	if (selectedValue == "duration_2011") {
		col=d.Duration_2011;
	}
	if (selectedValue == "duration_2012") {
		col=d.Duration_2012;
	}
	if (selectedValue == "duration_2013") {
		col=d.Duration_2013;
	}
	if (selectedValue == "duration_2014") {
		col=d.Duration_2014;
	}
	if (selectedValue == "duration_2015") {
		col=d.Duration_2015;
	}
	if (selectedValue == "duration_2016") {
		col=d.Duration_2016;
	}
	
	if (selectedValue == "duration_male_2005") {
		col=d.Duration_male_2005;
	}
	if (selectedValue == "duration_male_2010") {
		col=d.Duration_male_2010;
	}
	if (selectedValue == "duration_male_2011") {
		col=d.Duration_male_2011;
	}
	if (selectedValue == "duration_male_2012") {
		col=d.Duration_male_2012;
	}
	if (selectedValue == "duration_male_2013") {
		col=d.Duration_male_2013;
	}
	if (selectedValue == "duration_male_2014") {
		col=d.Duration_male_2014;
	}
	if (selectedValue == "duration_male_2015") {
		col=d.Duration_male_2015;
	}
	if (selectedValue == "duration_male_2016") {
		col=d.Duration_male_2016;
	}
	
	if (selectedValue == "duration_female_2005") {
		col=d.Duration_female_2005;
	}
	if (selectedValue == "duration_female_2010") {
		col=d.Duration_female_2010;
	}
	if (selectedValue == "duration_female_2011") {
		col=d.Duration_female_2011;
	}
	if (selectedValue == "duration_female_2012") {
		col=d.Duration_female_2012;
	}
	if (selectedValue == "duration_female_2013") {
		col=d.Duration_female_2013;
	}
	if (selectedValue == "duration_female_2014") {
		col=d.Duration_female_2014;
	}
	if (selectedValue == "duration_female_2015") {
		col=d.Duration_female_2015;
	}
	if (selectedValue == "duration_female_2016") {
		col=d.Duration_female_2016;
	}
	
	if (selectedValue == "morbidity_2005") {
		col=d.Morbidity_2005;
	}
	if (selectedValue == "morbidity_2010") {
		col=d.Morbidity_2010;
	}
	if (selectedValue == "morbidity_2011") {
		col=d.Morbidity_2011;
	}
	if (selectedValue == "morbidity_2012") {
		col=d.Morbidity_2012;
	}
	if (selectedValue == "morbidity_2013") {
		col=d.Morbidity_2013;
	}
	if (selectedValue == "morbidity_2014") {
		col=d.Morbidity_2014;
	}
	if (selectedValue == "morbidity_2015") {
		col=d.Morbidity_2015;
	}
	if (selectedValue == "morbidity_2016") {
		col=d.Morbidity_2016;
	}
	
    return parseInt(col) >= h;
  })
  
  <!-- var newData = dataset.filter(function(d) { -->
    <!-- return parseInt(d.date) >= h; -->
  <!-- }) -->
  
  colorFillMinRange = h;
  changeSliderFlag = h;

  updateChoro(selectedValue);
  drawPlot(newData);
}
</script>
<!--div class="center" id="vis" style="margin-top: -50px;"></div-->
<!--div class="center" style="padding-left: 150px;" id="slider2"></div-->
</body>
</html>